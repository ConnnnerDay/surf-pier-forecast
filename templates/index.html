<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ forecast.location_name or 'Fishing Forecast' }} &mdash; Surf &amp; Pier Forecast</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="header-inner">
            <h1>Surf &amp; Pier Fishing Outlook</h1>
            <p class="subtitle">{{ forecast.location_name or 'Wrightsville Beach &amp; Carolina Beach, NC' }}</p>
            <a href="{{ url_for('setup') }}" class="change-location">Change location</a>
            {% if cached %}
            <div class="banner">Cached forecast from {{ forecast.generated_at }}</div>
            {% endif %}
        </div>
    </header>

    <main>
        <!-- Verdict hero -->
        <section class="verdict-hero">
            <div class="verdict-badge verdict-{{ forecast.conditions.verdict|lower|replace(' ', '-') }}">
                {{ forecast.conditions.verdict }}
            </div>
            <p class="verdict-sub">24-hour fishability outlook</p>
        </section>

        <!-- Conditions grid -->
        <section class="conditions-section">
            <h2>Marine Conditions</h2>
            <div class="stat-grid">
                <div class="stat-card">
                    <span class="stat-label">Wind</span>
                    <span class="stat-value">{{ forecast.conditions.wind }}</span>
                    <span class="stat-detail">next 24 h</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Waves</span>
                    <span class="stat-value">{{ forecast.conditions.waves }}</span>
                    <span class="stat-detail">next 24 h</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Water Temp</span>
                    <span class="stat-value">{{ forecast.conditions.water_temp_f }}&deg;F</span>
                    <span class="stat-detail">{% if forecast.conditions.water_temp_live %}live reading{% else %}monthly avg{% endif %}</span>
                </div>
                {% if forecast.conditions.wind_dir %}
                <div class="stat-card stat-card--compass">
                    <span class="stat-label">Direction</span>
                    <div class="wind-compass">
                        <svg class="compass-svg" viewBox="0 0 80 80" width="56" height="56">
                            <circle cx="40" cy="40" r="36" fill="none" stroke="#d1d9e0" stroke-width="1.5"/>
                            <text x="40" y="10" text-anchor="middle" font-size="7" font-weight="600" fill="#6b7b8d">N</text>
                            <text x="72" y="43" text-anchor="middle" font-size="7" font-weight="600" fill="#6b7b8d">E</text>
                            <text x="40" y="76" text-anchor="middle" font-size="7" font-weight="600" fill="#6b7b8d">S</text>
                            <text x="8" y="43" text-anchor="middle" font-size="7" font-weight="600" fill="#6b7b8d">W</text>
                            {% set dir_degrees = {
                                'N': 0, 'NNE': 22.5, 'NE': 45, 'ENE': 67.5,
                                'E': 90, 'ESE': 112.5, 'SE': 135, 'SSE': 157.5,
                                'S': 180, 'SSW': 202.5, 'SW': 225, 'WSW': 247.5,
                                'W': 270, 'WNW': 292.5, 'NW': 315, 'NNW': 337.5
                            } %}
                            <g transform="rotate({{ dir_degrees.get(forecast.conditions.wind_dir, 0) }}, 40, 40)">
                                <polygon points="40,12 35,40 40,36 45,40" fill="#e05830" stroke="#c0392b" stroke-width="0.5"/>
                                <polygon points="40,68 35,40 40,44 45,40" fill="#d1d9e0" stroke="#b0bec5" stroke-width="0.5"/>
                            </g>
                            <circle cx="40" cy="40" r="3" fill="#e05830"/>
                        </svg>
                    </div>
                    <span class="stat-detail">{{ forecast.conditions.wind_dir }} wind</span>
                </div>
                {% else %}
                <div class="stat-card">
                    <span class="stat-label">Sun</span>
                    <span class="stat-value">{{ forecast.conditions.sunrise_sunset }}</span>
                    <span class="stat-detail">sunrise / sunset</span>
                </div>
                {% endif %}
                {% if forecast.conditions.wind_dir %}
                <div class="stat-card">
                    <span class="stat-label">Sun</span>
                    <span class="stat-value">{{ forecast.conditions.sunrise_sunset }}</span>
                    <span class="stat-detail">sunrise / sunset</span>
                </div>
                {% endif %}
            </div>
        </section>

        <!-- Tide predictions -->
        {% if forecast.tides %}
        <section class="tide-section">
            <h2>Today's Tides</h2>
            <p class="section-sub">High &amp; low tide times from NOAA predictions</p>
            <div class="tide-timeline">
                {% for tide in forecast.tides %}
                <div class="tide-point tide-{{ tide.type|lower }}">
                    <div class="tide-type-icon">
                        {% if tide.type == 'High' %}
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M2 12c2-3 4-5 6-5s4 5 6 5 4-5 6-5"/>
                            <path d="M2 17c2-3 4-5 6-5s4 5 6 5 4-5 6-5"/>
                        </svg>
                        {% else %}
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M2 14c2-2 4-3 6-3s4 3 6 3 4-3 6-3"/>
                        </svg>
                        {% endif %}
                    </div>
                    <div class="tide-info">
                        <span class="tide-type">{{ tide.type }}</span>
                        <span class="tide-time">{{ tide.time }}</span>
                    </div>
                    <span class="tide-height">{{ tide.height_ft }} ft</span>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Solunar fishing times -->
        {% if forecast.solunar %}
        <section class="solunar-section">
            <h2>Best Fishing Times</h2>
            <p class="section-sub">Solunar forecast &mdash; {{ forecast.solunar.moon_phase }} &mdash; {{ forecast.solunar.rating }} day</p>

            <div class="solunar-grid">
                <!-- Major periods -->
                {% for period in forecast.solunar.major_periods %}
                <div class="solunar-card solunar-major">
                    <div class="solunar-icon">
                        <svg viewBox="0 0 24 24" width="22" height="22" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="5"/>
                            <line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/>
                            <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/>
                            <line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/>
                            <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/>
                        </svg>
                    </div>
                    <div class="solunar-info">
                        <span class="solunar-label">Major Period</span>
                        <span class="solunar-times">{{ period.start }} &ndash; {{ period.end }}</span>
                    </div>
                </div>
                {% endfor %}

                <!-- Minor periods -->
                {% for period in forecast.solunar.minor_periods %}
                <div class="solunar-card solunar-minor">
                    <div class="solunar-icon">
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/>
                        </svg>
                    </div>
                    <div class="solunar-info">
                        <span class="solunar-label">Minor Period</span>
                        <span class="solunar-times">{{ period.start }} &ndash; {{ period.end }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Species ranking -->
        <section class="species-section">
            <h2>What's Biting Now</h2>
            <p class="section-sub">Top {{ forecast.species|length }} based on current conditions</p>
            <div class="species-cards">
                {% for sp in forecast.species %}
                <div class="species-card">
                    <div class="species-rank-area">
                        <div class="species-rank">#{{ sp.rank }}</div>
                        <span class="activity-badge activity-{{ sp.activity|lower }}">{{ sp.activity }}</span>
                    </div>
                    <div class="species-body">
                        <h3>{{ sp.name }}</h3>
                        <p class="species-why">{{ sp.explanation }}</p>
                        <div class="species-score-bar">
                            <div class="score-track">
                                <div class="score-fill score-fill--{{ sp.activity|lower }}" style="width: {{ sp.score }}%"></div>
                            </div>
                            <span class="score-label">{{ sp.score }}/100</span>
                        </div>
                        <div class="species-meta">
                            <div class="meta-item meta-item--bait">
                                <span class="meta-label">Bait</span>
                                <span class="meta-value">{{ sp.bait }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Rig</span>
                                <span class="meta-value">{{ sp.rig }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Hook</span>
                                <span class="meta-value">{{ sp.hook_size }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Sinker</span>
                                <span class="meta-value">{{ sp.sinker }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Recommended Rigs -->
        {% if forecast.rig_recommendations %}
        <section class="rig-section">
            <h2>Recommended Rigs</h2>
            <p class="section-sub">Matched to species biting now</p>
            <div class="rig-cards">
                {% for rig in forecast.rig_recommendations %}
                <div class="rig-card">
                    <h3>{{ rig.name }}</h3>
                    {% if rig.image %}
                    <div class="rig-diagram">
                        <img src="{{ url_for('static', filename=rig.image) }}" alt="{{ rig.name }} diagram" loading="lazy">
                    </div>
                    {% endif %}
                    <p class="rig-desc">{{ rig.description }}</p>
                    <div class="rig-targets">
                        <span class="rig-targets-label">Good for:</span>
                        {% for t in rig.targets %}
                        <span class="rig-target-tag">{{ t }}</span>
                        {% endfor %}
                    </div>
                    <dl class="rig-specs">
                        <dt>Mainline</dt><dd>{{ rig.mainline }}</dd>
                        <dt>Leader</dt><dd>{{ rig.leader }}</dd>
                        <dt>Hook</dt><dd>{{ rig.hook }}</dd>
                        <dt>Sinker</dt><dd>{{ rig.sinker }}</dd>
                    </dl>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Bait recommendations -->
        <section class="bait-section">
            <h2>Natural Bait Recommendations</h2>
            <div class="bait-list">
                {% for item in forecast.bait_rankings %}
                <div class="bait-item">
                    <span class="bait-num">{{ loop.index }}</span>
                    <div class="bait-info">
                        <strong>{{ item.bait }}</strong>
                        <span>{{ item.notes }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- 3-Day Outlook -->
        {% if forecast.outlook %}
        <section class="outlook-section">
            <h2>3-Day Outlook</h2>
            <p class="section-sub">Upcoming conditions forecast</p>
            <div class="outlook-grid">
                {% for day in forecast.outlook %}
                <div class="outlook-card">
                    <div class="outlook-header">
                        <span class="outlook-day">{{ day.day }}</span>
                        <span class="outlook-date">{{ day.date }}</span>
                    </div>
                    <div class="outlook-verdict verdict-badge verdict-{{ day.verdict|lower|replace(' ', '-') }}">
                        {{ day.verdict }}
                    </div>
                    <div class="outlook-details">
                        <div class="outlook-detail">
                            <span class="outlook-detail-label">Wind</span>
                            <span class="outlook-detail-value">{{ day.wind }}</span>
                        </div>
                        <div class="outlook-detail">
                            <span class="outlook-detail-label">Waves</span>
                            <span class="outlook-detail-value">{{ day.waves }}</span>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Refresh -->
        <section class="refresh">
            <form method="post" action="{{ url_for('api_refresh') }}">
                <button type="submit">Refresh Forecast</button>
            </form>
            <p class="timestamp">Updated {{ forecast.age_human if forecast.age_human else forecast.generated_at }}</p>
        </section>
    </main>

    <footer>
        <p>&copy; {{ forecast.generated_at[:4] }} Surf &amp; Pier Fishing Outlook &mdash; {{ forecast.location_name or 'Wrightsville Beach &amp; Carolina Beach, NC' }}</p>
    </footer>
</body>
</html>
