<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wrightsville &amp; Carolina Beach Fishing Forecast</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="header-inner">
            <h1>Surf &amp; Pier Fishing Outlook</h1>
            <p class="subtitle">Wrightsville Beach &amp; Carolina Beach, NC</p>
            {% if cached %}
            <div class="banner">Cached forecast from {{ forecast.generated_at }}</div>
            {% endif %}
        </div>
    </header>

    <main>
        <!-- Verdict hero -->
        <section class="verdict-hero">
            <div class="verdict-badge verdict-{{ forecast.conditions.verdict|lower|replace(' ', '-') }}">
                {{ forecast.conditions.verdict }}
            </div>
            <p class="verdict-sub">24-hour fishability outlook</p>
        </section>

        <!-- Conditions grid -->
        <section class="conditions-section">
            <h2>Marine Conditions</h2>
            <div class="stat-grid">
                <div class="stat-card">
                    <span class="stat-label">Wind</span>
                    <span class="stat-value">{{ forecast.conditions.wind }}</span>
                    <span class="stat-detail">next 24 h</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Waves</span>
                    <span class="stat-value">{{ forecast.conditions.waves }}</span>
                    <span class="stat-detail">next 24 h</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Water Temp</span>
                    <span class="stat-value">{{ forecast.conditions.water_temp_f }}&deg;F</span>
                    <span class="stat-detail">{% if forecast.conditions.water_temp_live %}live reading{% else %}monthly avg{% endif %}</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Tide</span>
                    <span class="stat-value stat-value-sm">{{ forecast.conditions.tide_trend }}</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Sun</span>
                    <span class="stat-value">{{ forecast.conditions.sunrise_sunset }}</span>
                    <span class="stat-detail">sunrise / sunset</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Moon</span>
                    <span class="stat-value">{{ forecast.moon.phase_name }}</span>
                    <span class="stat-detail">{{ forecast.moon.illumination_pct }}% illumination</span>
                </div>
            </div>
        </section>

        <!-- Solunar + Fishing Windows row -->
        <div class="two-col">
            <section class="card solunar-card">
                <h2>Solunar Rating</h2>
                {% if forecast.moon %}
                <div class="solunar-badge solunar-{{ forecast.moon.solunar_rating|lower }}">
                    {{ forecast.moon.solunar_rating }}
                </div>
                <p class="solunar-tip">
                    {% if forecast.moon.solunar_rating == "Excellent" %}
                    New/full moon drives strong tidal movement and aggressive feeding. Expect above-average bite activity.
                    {% elif forecast.moon.solunar_rating == "Good" %}
                    Moon phase is favorable for feeding. Good tidal flow should produce steady action.
                    {% elif forecast.moon.solunar_rating == "Fair" %}
                    Mid-quarter moon produces moderate tidal flow. Focus on tide changes for best results.
                    {% else %}
                    Weak solunar period. Fish during tide changes for best results.
                    {% endif %}
                </p>
                {% endif %}
            </section>

            {% if forecast.windows %}
            <section class="card windows-card">
                <h2>Best Fishing Windows</h2>
                <div class="window-list">
                    {% for w in forecast.windows %}
                    <div class="window-item window-{{ w.quality|lower }}">
                        <span class="window-quality">{{ w.quality }}</span>
                        <div class="window-info">
                            <strong>{{ w.time }}</strong>
                            <span>{{ w.reason }}</span>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            {% endif %}
        </div>

        <!-- Tide schedule -->
        {% if forecast.tides %}
        <section class="card tide-card">
            <h2>Tide Schedule</h2>
            <div class="tide-timeline">
                {% for t in forecast.tides %}
                <div class="tide-event tide-{{ t.type|lower }}">
                    <div class="tide-marker"></div>
                    <div class="tide-detail">
                        <span class="tide-time">{{ t.time }}</span>
                        <span class="tide-label">{{ t.type }} Tide</span>
                        <span class="tide-height">{{ t.height_ft }} ft</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Species ranking -->
        <section class="species-section">
            <h2>Ranked Species Forecast</h2>
            <div class="species-cards">
                {% for sp in forecast.species %}
                <div class="species-card">
                    <div class="species-rank">#{{ sp.rank }}</div>
                    <div class="species-body">
                        <h3>{{ sp.name }}</h3>
                        <p class="species-why">{{ sp.explanation }}</p>
                        <div class="species-meta">
                            <div class="meta-item">
                                <span class="meta-label">Bait</span>
                                <span class="meta-value">{{ sp.bait }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Rig</span>
                                <span class="meta-value">{{ sp.rig }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Hook</span>
                                <span class="meta-value">{{ sp.hook_size }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Sinker</span>
                                <span class="meta-value">{{ sp.sinker }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Rig templates -->
        <section>
            <h2>Bottom-Rig Templates</h2>
            <div class="rig-cards">
                {% for rig in forecast.rig_templates %}
                <div class="rig-card">
                    <h3>{{ rig.name }}</h3>
                    <p class="rig-desc">{{ rig.description }}</p>
                    <dl class="rig-specs">
                        <dt>Mainline</dt><dd>{{ rig.mainline }}</dd>
                        <dt>Leader</dt><dd>{{ rig.leader }}</dd>
                        <dt>Hook</dt><dd>{{ rig.hook }}</dd>
                        <dt>Sinker</dt><dd>{{ rig.sinker }}</dd>
                    </dl>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Bait recommendations -->
        <section>
            <h2>Natural Bait Recommendations</h2>
            <div class="bait-list">
                {% for item in forecast.bait_rankings %}
                <div class="bait-item">
                    <span class="bait-num">{{ loop.index }}</span>
                    <div class="bait-info">
                        <strong>{{ item.bait }}</strong>
                        <span>{{ item.notes }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Refresh -->
        <section class="refresh">
            <form method="post" action="{{ url_for('api_refresh') }}">
                <button type="submit">Refresh Forecast</button>
            </form>
            <p class="timestamp">Last generated: {{ forecast.generated_at }}</p>
        </section>
    </main>

    <footer>
        <p>&copy; {{ forecast.generated_at[:4] }} Surf &amp; Pier Fishing Outlook &mdash; Wrightsville Beach &amp; Carolina Beach, NC</p>
    </footer>
</body>
</html>
