<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ forecast.location_name or 'Fishing Forecast' }} &mdash; Surf &amp; Pier Forecast</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=DM+Serif+Display&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
    <header>
        <div class="header-inner">
            <h1>Surf &amp; Pier Fishing Outlook</h1>
            <p class="subtitle">{{ forecast.location_name or 'Wrightsville Beach &amp; Carolina Beach, NC' }}</p>
            <a href="{{ url_for('setup') }}" class="change-location">Change location</a>
            {% if cached %}
            <div class="banner">Cached forecast from {{ forecast.generated_at }}</div>
            {% endif %}
        </div>
    </header>

    <main>
        <!-- Verdict hero -->
        <section class="verdict-hero">
            <div class="verdict-badge verdict-{{ forecast.conditions.verdict|lower|replace(' ', '-') }}">
                {{ forecast.conditions.verdict }}
            </div>
            <p class="verdict-sub">24-hour fishability outlook</p>
        </section>

        <!-- Conditions grid -->
        <section class="conditions-section">
            <h2>Marine Conditions</h2>
            <div class="stat-grid">
                <div class="stat-card">
                    <span class="stat-label">Wind</span>
                    <span class="stat-value">{{ forecast.conditions.wind }}</span>
                    <span class="stat-detail">next 24 h</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Waves</span>
                    <span class="stat-value">{{ forecast.conditions.waves }}</span>
                    <span class="stat-detail">next 24 h</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Water Temp</span>
                    <span class="stat-value">{{ forecast.conditions.water_temp_f }}&deg;F</span>
                    <span class="stat-detail">{% if forecast.conditions.water_temp_live %}live reading{% else %}monthly avg{% endif %}</span>
                </div>
                <div class="stat-card">
                    <span class="stat-label">Sun</span>
                    <span class="stat-value">{{ forecast.conditions.sunrise_sunset }}</span>
                    <span class="stat-detail">sunrise / sunset</span>
                </div>
            </div>
        </section>

        <!-- Tide predictions -->
        {% if forecast.tides %}
        <section class="tide-section">
            <h2>Today's Tides</h2>
            <p class="section-sub">High &amp; low tide times from NOAA predictions</p>
            <div class="tide-timeline">
                {% for tide in forecast.tides %}
                <div class="tide-point tide-{{ tide.type|lower }}">
                    <div class="tide-type-icon">
                        {% if tide.type == 'High' %}
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M2 12c2-3 4-5 6-5s4 5 6 5 4-5 6-5"/>
                            <path d="M2 17c2-3 4-5 6-5s4 5 6 5 4-5 6-5"/>
                        </svg>
                        {% else %}
                        <svg viewBox="0 0 24 24" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M2 14c2-2 4-3 6-3s4 3 6 3 4-3 6-3"/>
                        </svg>
                        {% endif %}
                    </div>
                    <div class="tide-info">
                        <span class="tide-type">{{ tide.type }}</span>
                        <span class="tide-time">{{ tide.time }}</span>
                    </div>
                    <span class="tide-height">{{ tide.height_ft }} ft</span>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Species ranking -->
        <section class="species-section">
            <h2>What's Biting Now</h2>
            <p class="section-sub">Top {{ forecast.species|length }} based on current conditions</p>
            <div class="species-cards">
                {% for sp in forecast.species %}
                <div class="species-card">
                    <div class="species-rank-area">
                        <div class="species-rank">#{{ sp.rank }}</div>
                        <span class="activity-badge activity-{{ sp.activity|lower }}">{{ sp.activity }}</span>
                    </div>
                    <div class="species-body">
                        <h3>{{ sp.name }}</h3>
                        <p class="species-why">{{ sp.explanation }}</p>
                        <div class="species-score-bar">
                            <div class="score-track">
                                <div class="score-fill score-fill--{{ sp.activity|lower }}" style="width: {{ sp.score }}%"></div>
                            </div>
                            <span class="score-label">{{ sp.score }}/100</span>
                        </div>
                        <div class="species-meta">
                            <div class="meta-item meta-item--bait">
                                <span class="meta-label">Bait</span>
                                <span class="meta-value">{{ sp.bait }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Rig</span>
                                <span class="meta-value">{{ sp.rig }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Hook</span>
                                <span class="meta-value">{{ sp.hook_size }}</span>
                            </div>
                            <div class="meta-item">
                                <span class="meta-label">Sinker</span>
                                <span class="meta-value">{{ sp.sinker }}</span>
                            </div>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Recommended Rigs -->
        {% if forecast.rig_recommendations %}
        <section class="rig-section">
            <h2>Recommended Rigs</h2>
            <p class="section-sub">Matched to species biting now</p>
            <div class="rig-cards">
                {% for rig in forecast.rig_recommendations %}
                <div class="rig-card">
                    <h3>{{ rig.name }}</h3>
                    {% if rig.image %}
                    <div class="rig-diagram">
                        <img src="{{ url_for('static', filename=rig.image) }}" alt="{{ rig.name }} diagram" loading="lazy">
                    </div>
                    {% endif %}
                    <p class="rig-desc">{{ rig.description }}</p>
                    <div class="rig-targets">
                        <span class="rig-targets-label">Good for:</span>
                        {% for t in rig.targets %}
                        <span class="rig-target-tag">{{ t }}</span>
                        {% endfor %}
                    </div>
                    <dl class="rig-specs">
                        <dt>Mainline</dt><dd>{{ rig.mainline }}</dd>
                        <dt>Leader</dt><dd>{{ rig.leader }}</dd>
                        <dt>Hook</dt><dd>{{ rig.hook }}</dd>
                        <dt>Sinker</dt><dd>{{ rig.sinker }}</dd>
                    </dl>
                </div>
                {% endfor %}
            </div>
        </section>
        {% endif %}

        <!-- Bait recommendations -->
        <section class="bait-section">
            <h2>Natural Bait Recommendations</h2>
            <div class="bait-list">
                {% for item in forecast.bait_rankings %}
                <div class="bait-item">
                    <span class="bait-num">{{ loop.index }}</span>
                    <div class="bait-info">
                        <strong>{{ item.bait }}</strong>
                        <span>{{ item.notes }}</span>
                    </div>
                </div>
                {% endfor %}
            </div>
        </section>

        <!-- Refresh -->
        <section class="refresh">
            <form method="post" action="{{ url_for('api_refresh') }}">
                <button type="submit">Refresh Forecast</button>
            </form>
            <p class="timestamp">Updated {{ forecast.age_human if forecast.age_human else forecast.generated_at }}</p>
        </section>
    </main>

    <footer>
        <p>&copy; {{ forecast.generated_at[:4] }} Surf &amp; Pier Fishing Outlook &mdash; {{ forecast.location_name or 'Wrightsville Beach &amp; Carolina Beach, NC' }}</p>
    </footer>
</body>
</html>
